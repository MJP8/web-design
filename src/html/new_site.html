<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Build a site &mdash; Spider Web Design</title>
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/form.css">
</head>

<body>
    <header>
        <nav>
            <ul></ul>
        </nav>
    </header>
    <main>
        <form action="/new_site/finished/" method="post" novalidate enctype="application/x-www-form-urlencoded">
            <fieldset>
                <legend>Metadata</legend>
                <hr>
                <ol>
                    <li>
                        <label for="meta-t">Title:</label>
                        <input type="text" id="meta-t" name="meta-t" placeholder="The title displayed at the top of the browser" required />
                    </li>
                    <li>
                        <label for="meta-d">Description:</label>
                        <textarea name="meta-d" id="meta-d" cols="20" rows="5" placeholder="20 words or less" required>Made by Spider Web Design</textarea>
                    </li>
                    <li>
                        <label for="meta-k">Keywords:</label>
                        <textarea name="meta-k" id="meta-k" cols="20" rows="3" placeholder="Separate with a ','" required></textarea>
                    </li>
                    <li>
                        <label for="meta-a">Author:</label>
                        <input type="text" name="meta-a" id="meta-a" placeholder="The author of the site" />
                    </li>
                </ol>
            </fieldset>
            <fieldset>
                <legend>Layout</legend>
                <hr>
                <ol>
                    <li>
                        <label for="layout-o">Overall layout:</label>
                        <select name="layout-o" id="layout-o">
                            <option disabled selected>Layout</option>
                            <optgroup label="Desktops / Laptops">
                                <option>Default</option>
                                <option>Sidebar and Navigation</option>
                                <option>Sidebar</option>
                            </optgroup>
                            <optgroup label="Mobile">
                                <option>Mobile Default</option>
                            </optgroup>
                            <optgroup label="Responsive">
                                <option>Responsive Default</option>
                                <option>Responsive Sidebar</option>
                            </optgroup>
                        </select>
                    </li>
                </ol>
            </fieldset>
            <hr>
            <button type="submit">Submit</button>
        </form>
    </main>
    <footer>
        <h1>Spider Web Design</h1>
        <ul></ul>
    </footer>
    <script src="/js/jquery.js"></script>
    <script src="/js/index.js"></script>
    <script>
        function setErrorMessage(el, message) {
            $(el).data('errorMessage', message);
        }

        function validateKeywords() {
            let keywords = document.getElementById('meta-k');
            let pattern = /(\S+(,|, +|,\s+))+\S+/;
            let valid = pattern.test(keywords.value);
            if (!valid) {
                setErrorMessage(keywords, 'Please separate with commas');
            }
            return valid;
        }

        function showErrorMessage(el) {
            let $el = $(el);
            let $errorContainer = $el.siblings('.error');
            if (!$errorContainer.length) {
                $errorContainer = $('<span class="error"></span>').insertAfter($el);
            }
            $errorContainer.text($(el).data('errorMessage'));
        }

        function isEmpty(el) {
            return !el.value || el.value == el.placeholder;
        }

        function isRequired(el) {
            return ((typeof el.required === 'boolean') && el.required);
        }

        function validateRequired(el) {
            if (isRequired(el)) {
                let valid = !isEmpty(el);
                if (!valid) {
                    setErrorMessage(el, 'Field is required')
                }
                return valid;
            }
            return true;
        }

        function removeErrorMessage(el) {
            let $el = $(el);
            $el.removeAttr('errorMessage');
            $el.siblings('.error').remove();
        }

        function validateLayout() {
            let el = document.getElementById('layout-o');
            let valid = !(el.value === 'Layout');
            if (!valid) {
                setErrorMessage(el, '\'Layout\' is not a layout');
            }
            return valid;
        }
        (function() {
            $('form').on('submit', function(e) {
                e.preventDefault();
                let elements = this.elements;
                let valid = {};
                let isValid;
                let isFormValid;
                for (let i = 0, l = (elements.length - 1); i < l; i++) {
                    isValid = validateRequired(elements[i]);
                    if (!isValid) {
                        showErrorMessage(elements[i]);
                    } else {
                        removeErrorMessage(elements[i]);
                    }
                    valid[elements[i].id] = isValid;
                }
                if ($('#meta-k').val() !== '') {
                    if (!validateKeywords()) {
                        showErrorMessage(document.getElementById('meta-k'));
                        valid['meta-k'] = false;
                    } else {
                        removeErrorMessage(document.getElementById('meta-k'));
                    }
                }
                if (!validateLayout()) {
                    showErrorMessage(document.getElementById('layout-o'));
                    valid['layout-o'] = false;
                } else {
                    removeErrorMessage(document.getElementById('layout-o'));
                }
                for (const field in valid) {
                    if (!valid[field]) {
                        isFormValid = false;
                        break;
                    }
                    isFormValid = true;
                }
                if (isFormValid) {
                    this.submit();
                }
            });
        }());
    </script>
</body>

</html>